<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Sasha AI - Smooth & Smart</title>
    <style>
        :root { --neon: #00d8ff; }
        body, html { margin: 0; padding: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; height: 100%; overflow: hidden; }

        /* КНОПКИ (СЛЕВА ВВЕРХУ) */
        .top-nav { position: fixed; top: 20px; left: 20px; z-index: 1000; display: flex; gap: 15px; }
        .btn { 
            padding: 10px 20px; border: 1px solid var(--neon); background: rgba(0,0,0,0.7); 
            color: var(--neon); cursor: pointer; font-weight: bold; border-radius: 5px; transition: 0.3s;
        }
        .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }
        .btn:disabled { opacity: 0.2; }

        /* ЧАТ (СЛЕВА ВНИЗУ) */
        #chat-ui { 
            position: fixed; bottom: 25px; left: 25px; width: 360px; height: 400px; 
            background: rgba(10,10,10,0.85); border: 1px solid #222; border-radius: 15px;
            z-index: 1000; display: flex; flex-direction: column; backdrop-filter: blur(10px);
        }
        #chat-box { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; font-size: 14px; }
        .msg { padding: 10px; border-radius: 10px; max-width: 85%; }
        .ai { background: rgba(0, 216, 255, 0.1); color: var(--neon); align-self: flex-start; border-left: 3px solid var(--neon); }
        .user { background: #222; align-self: flex-end; }

        .input-row { padding: 10px; display: flex; gap: 5px; border-top: 1px solid #222; }
        #query { flex: 1; background: #000; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 5px; outline: none; }

        #view { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
    </style>
</head>
<body>

    <div class="top-nav">
        <button class="btn" onclick="openReg()">Регистрация</button>
        <button class="btn" id="login-btn" disabled>Вход</button>
    </div>

    <div id="view"></div>

    <div id="chat-ui">
        <div id="chat-box"><div class="msg ai">Саша: Системы стабилизированы. Анимация выровнена. Я готов.</div></div>
        <div class="input-row">
            <input type="text" id="query" placeholder="Спроси Сашу...">
            <button class="btn" onclick="talk()">SEND</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        let sasha, isSpeaking = false, targetScale = 1.7, currentScale = 1.7;
        const clock = new THREE.Clock();

        // --- ЛОГИКА ИИ И ПАМЯТИ ---
        function talk() {
            const inp = document.getElementById('query');
            const val = inp.value.trim();
            if(!val) return;

            addMsg("Вы", val, "user");
            inp.value = '';

            // Локальный анализ
            let reply = "Я анализирую данные... Мой локальный мозг зафиксировал: " + val;
            if(val.toLowerCase().includes("кто я")) reply = "Ты мой создатель, Босс. Я тебя помню.";
            
            setTimeout(() => {
                addMsg("Саша", reply, "ai");
                speak(reply);
            }, 400);
        }

        function addMsg(a, t, c) {
            const b = document.getElementById('chat-box');
            b.innerHTML += `<div class="msg ${c}"><b>${a}:</b> ${t}</div>`;
            b.scrollTop = b.scrollHeight;
        }

        function speak(t) {
            window.speechSynthesis.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.pitch = 0.85; u.onstart = () => isSpeaking = true; u.onend = () => isSpeaking = false;
            window.speechSynthesis.speak(u);
        }

        // --- ПЛАВНОЕ 3D ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setPixelRatio(window.devicePixelRatio); // Для четкости
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('view').appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 2));
        camera.position.z = 5;

        new THREE.GLTFLoader().load('https://raw.githubusercontent.com/aproyt4-lang/GameDevAlex/main/SashaAI.glb', (gltf) => {
            sasha = gltf.scene;
            sasha.position.y = -1.2;
            scene.add(sasha);
            animate();
        });

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            const time = clock.getElapsedTime();

            if (sasha) {
                // Плавное вращение (независимо от FPS)
                sasha.rotation.y += 0.5 * delta;

                // Плавное дыхание и говорение через Lerp
                targetScale = isSpeaking ? (1.7 + Math.sin(time * 10) * 0.1) : (1.7 + Math.sin(time * 2) * 0.03);
                
                // Сглаживание изменения масштаба
                currentScale += (targetScale - currentScale) * 0.1; 
                sasha.scale.set(currentScale, currentScale, currentScale);
            }
            renderer.render(scene, camera);
        }

        function openReg() {
            const n = prompt("Твое имя, Босс?");
            if(n) {
                localStorage.setItem('user', n);
                document.getElementById('login-btn').disabled = false;
                speak(`Привет, ${n}. Я запомнил тебя.`);
            }
        }

        window.onresize = () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        };
    </script>
</body>
</html>










