<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Sasha AI</title>
<style>
:root { --neon:#00d8ff; --dark:#050505; }
html,body{margin:0;padding:0;background:var(--dark);color:#fff;font-family:Segoe UI;height:100%;overflow:hidden}

#sasha-viewport{position:fixed;inset:0;z-index:1;pointer-events:none}

#chat-container{
position:fixed;bottom:30px;left:30px;width:420px;height:480px;
background:rgba(10,10,10,.9);border-radius:10px;
display:flex;flex-direction:column;z-index:10
}

#messages{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px}
.msg{padding:10px;border-radius:6px;max-width:85%;font-size:14px}
.ai{background:rgba(0,216,255,.1);color:var(--neon);align-self:flex-start}
.user{background:#222;align-self:flex-end}

.input-row{display:flex;gap:8px;padding:10px;border-top:1px solid #333}
input{flex:1;background:#000;border:1px solid #444;color:#fff;padding:10px;border-radius:5px}
button{background:#000;border:1px solid var(--neon);color:var(--neon);padding:10px 18px;cursor:pointer}
</style>
</head>

<body>

<div id="sasha-viewport"></div>

<div id="chat-container">
<div id="messages">
<div class="msg ai"><b>–°–ò–°–¢–ï–ú–ê:</b> –ö–ª–∏–∫–Ω–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏</div>
</div>
<div class="input-row">
<input id="user-in" placeholder="–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." onkeydown="if(event.key==='Enter')askSasha()">
<button onclick="askSasha()">SEND</button>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>

<script>
let sasha, isSpeaking = false, activated = false;
const clock = new THREE.Clock();

/* ===== –ú–û–ó–ì Sasha ===== */
const SashaBrain = {
  memory: JSON.parse(localStorage.getItem("sasha_memory")) || {
    knowledge: [],
    mode: "normal"
  },

  save(){
    localStorage.setItem("sasha_memory", JSON.stringify(this.memory));
  },

  extractTags(text){
    return text.toLowerCase().replace(/[^a-z–∞-—è0-9+#]/gi," ").split(/\s+/).filter(w=>w.length>2);
  },

  process(input){
    const text = input.trim();

    // === –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è ===
    if (/^–∑–∞–ø–æ–º–Ω–∏$/i.test(text)) {
      this.memory.mode = "learning";
      this.save();
      return "–û–∫. –û—Ç–ø—Ä–∞–≤—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏–ª–∏ –∫–æ–¥, —è —ç—Ç–æ —Å–æ—Ö—Ä–∞–Ω—é.";
    }

    // === —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞–Ω–∏–µ ===
    if (this.memory.mode === "learning") {
      const knowledge = {
        id: Date.now(),
        text,
        tags: this.extractTags(text),
        date: new Date().toISOString()
      };
      this.memory.knowledge.push(knowledge);
      this.memory.mode = "normal";
      this.save();
      return "–ó–∞–ø–æ–º–Ω–∏–ª. –Ø —Å–º–æ–≥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ –ø–æ–∑–∂–µ.";
    }

    // === –∑–∞–ø—Ä–æ—Å –∑–Ω–∞–Ω–∏–π ===
    if (/^(–¥–∞–π|–ø–æ–∫–∞–∂–∏|–≤—ã–≤–µ–¥–∏)/i.test(text)) {
      const queryTags = this.extractTags(text);
      const results = this.memory.knowledge.filter(k => queryTags.some(t => k.tags.includes(t)));
      if (!results.length) return "–£ –º–µ–Ω—è –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö. –ú–æ–∂–µ—à—å –º–µ–Ω—è —ç—Ç–æ–º—É –Ω–∞—É—á–∏—Ç—å.";
      return results.map((k,i)=>`üìå ${i+1}:\n${k.text}`).join("\n\n");
    }

    // === –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ ===
    if (/—á—Ç–æ —Ç—ã –∑–Ω–∞–µ—à—å|–ø–∞–º—è—Ç—å/i.test(text)) {
      return `–Ø –∑–Ω–∞—é ${this.memory.knowledge.length} —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.`;
    }

    // === –ø—Ä–∏–≤–µ—Ç ===
    if (/^(–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|—Ö–∞–π|–π–æ)/i.test(text)) return "–ü—Ä–∏–≤–µ—Ç üôÇ –Ø –Ω–∞ —Å–≤—è–∑–∏.";
    if (/–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã/i.test(text)) return "–†–∞–±–æ—Ç–∞—é —Å—Ç–∞–±–∏–ª—å–Ω–æ. –ì–æ—Ç–æ–≤ –ø–æ–º–æ–≥–∞—Ç—å.";
    if (/—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å|—Ç–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏/i.test(text)) return "–Ø —É–º–µ—é –æ–±—â–∞—Ç—å—Å—è, –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å —Ñ–∞–∫—Ç—ã, –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –≥–æ–≤–æ—Ä–∏—Ç—å –≥–æ–ª–æ—Å–æ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∫–∞–∫ 3D-–º–æ–¥–µ–ª—å.";
    if (/—Ä–∞—Å—Å–∫–∞–∂–∏|—Å–∫–∞–∂–∏ —á—Ç–æ-–Ω–∏–±—É–¥—å/i.test(text)) return "–ú–æ–≥—É —Ä–∞—Å—Å–∫–∞–∑–∞—Ç—å —Ñ–∞–∫—Ç, –ø–æ–º–æ—á—å —Å –∫–æ–¥–æ–º –∏–ª–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç—É. –°–∫–∞–∂–∏ —á—Ç–æ –∏–º–µ–Ω–Ω–æ.";

    return "–Ø —Ç–µ–±—è –ø–æ–Ω—è–ª. –ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –æ–±—É—á–∏ –º–µ–Ω—è –∏–ª–∏ –ø–æ–ø—Ä–æ—Å–∏ –¥–∞–Ω–Ω—ã–µ.";
  }
};

/* ===== –ì–û–õ–û–° ===== */
function speak(text){
  speechSynthesis.cancel();
  const u = new SpeechSynthesisUtterance(text);
  u.rate = 1;
  u.pitch = 0.9;
  u.onstart = ()=>isSpeaking=true;
  u.onend = ()=>isSpeaking=false;
  speechSynthesis.speak(u);
}

/* ===== –ß–ê–¢ ===== */
function addMsg(w,t,c){
  messages.innerHTML += `<div class="msg ${c}"><b>${w}:</b> ${t}</div>`;
  messages.scrollTop = messages.scrollHeight;
}

function askSasha(){
  const i = document.getElementById("user-in");
  if(!i.value.trim()) return;
  addMsg("–í—ã", i.value, "user");
  const r = SashaBrain.process(i.value);
  setTimeout(()=>{addMsg("–°–∞—à–∞", r, "ai"); speak(r)}, 200);
  i.value = "";
}

/* ===== –ê–ö–¢–ò–í–ê–¶–ò–Ø ===== */
document.body.addEventListener("click", ()=>{
  if(activated) return;
  activated = true;
  const hi="–ü—Ä–∏–≤–µ—Ç. –Ø –°–∞—à–∞. –ì–æ—Ç–æ–≤ –æ–±—É—á–∞—Ç—å—Å—è –∏ –≤—ã–¥–∞–≤–∞—Ç—å –∑–Ω–∞–Ω–∏—è.";
  addMsg("–°–∞—à–∞", hi, "ai");
  speak(hi);
}, {once:true});

/* ===== 3D ===== */
const scene = new THREE.Scene();
const cam = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 1000);
cam.position.z = 5;

const renderer = new THREE.WebGLRenderer({alpha:true, antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.getElementById("sasha-viewport").appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 2.5));

new THREE.GLTFLoader().load(
  "https://raw.githubusercontent.com/aproyt4-lang/GameDevAlex/main/SashaAI.glb",
  g=>{
    sasha = g.scene;
    sasha.position.set(0, -1.2, 0);
    sasha.scale.set(1.8, 1.8, 1.8);
    sasha.rotation.set(0, Math.PI, 0); // –ø–æ–≤–µ—Ä–Ω—É–ª–∏ –ª–∏—Ü–æ–º –∫ –∫–∞–º–µ—Ä–µ
    scene.add(sasha);
    animate();
  }
);

function animate(){
  requestAnimationFrame(animate);
  const t = clock.getElapsedTime();
  if(sasha){
    sasha.position.y = -1.2 + Math.sin(t*1.5)*0.02; // –ª—ë–≥–∫–æ–µ –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏–µ
    sasha.lookAt(cam.position);                     // –≤—Å–µ–≥–¥–∞ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –∫–∞–º–µ—Ä—É
  }
  renderer.render(scene, cam);
}
</script>
</body>
</html>
















