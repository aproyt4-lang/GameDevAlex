<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AlexanderDev - Smart Sasha AI</title>
    <style>
        :root { --neon: #00d8ff; --accent: #ff00ea; }
        body, html { margin: 0; padding: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; height: 100%; overflow: hidden; }

        /* ФОН С МОДЕЛЬЮ */
        #three-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }

        /* ВЕРХНЯЯ ПАНЕЛЬ (КНОПКИ) */
        .top-nav { 
            position: fixed; top: 20px; left: 20px; z-index: 100; 
            display: flex; gap: 15px; 
        }
        .nav-btn { 
            padding: 10px 20px; border: 1px solid var(--neon); background: rgba(0,0,0,0.6); 
            color: var(--neon); border-radius: 5px; cursor: pointer; font-weight: bold; 
            transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }
        .nav-btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 15px var(--neon); }
        .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; border-color: #444; color: #444; }

        /* УМНЫЙ ЧАТ (СЛЕВА ВНИЗУ) */
        #chat-container { 
            position: fixed; bottom: 30px; left: 30px; width: 380px; height: 450px; 
            background: rgba(10,10,10,0.9); border: 1px solid var(--neon); 
            border-radius: 15px; z-index: 100; display: flex; flex-direction: column;
            backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0,216,255,0.1);
        }
        #chat-header { padding: 12px; border-bottom: 1px solid #333; font-size: 12px; color: var(--neon); letter-spacing: 1px; }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; scroll-behavior: smooth; }
        .msg { padding: 10px 14px; border-radius: 10px; font-size: 14px; max-width: 80%; line-height: 1.4; }
        .ai-msg { background: rgba(0, 216, 255, 0.1); color: var(--neon); align-self: flex-start; border-left: 3px solid var(--neon); }
        .user-msg { background: var(--neon); color: #000; align-self: flex-end; font-weight: 600; }

        .input-row { padding: 15px; border-top: 1px solid #333; display: flex; gap: 8px; }
        #user-input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; outline: none; }
        #send-btn { background: var(--neon); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* МОДАЛКА РЕГИСТРАЦИИ (УСЛОВНАЯ) */
        #reg-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(0,0,0,0.8); z-index: 1000; display: none;
            justify-content: center; align-items: center;
        }
        .modal-box { background: #111; padding: 30px; border: 1px solid var(--accent); border-radius: 20px; width: 300px; text-align: center; }

        #api-key-wrapper { position: fixed; top: 20px; right: 20px; z-index: 100; }
        #api-key { background: #111; border: 1px solid #333; color: #555; padding: 5px; border-radius: 5px; font-size: 10px; width: 150px; }
    </style>
</head>
<body>

    <div id="api-key-wrapper">
        <input type="password" id="api-key" placeholder="Gemini API Key">
    </div>

    <div class="top-nav">
        <button class="nav-btn" onclick="openReg()">Регистрация</button>
        <button class="nav-btn" id="login-btn" disabled onclick="alert('Вход выполнен!')">Вход</button>
    </div>

    <canvas id="three-canvas"></canvas>

    <div id="chat-container">
        <div id="chat-header">САША АИ // АНАЛИТИЧЕСКИЙ МОДУЛЬ</div>
        <div id="messages">
            <div class="msg ai-msg">Саша: Привет! Я Саша. Я помню всё, что мы обсуждаем. Вставь API ключ сверху справа, и начнем глубокий анализ.</div>
        </div>
        <div class="input-row">
            <input type="text" id="user-input" placeholder="Введите запрос...">
            <button id="send-btn" onclick="askSasha()">SEND</button>
        </div>
    </div>

    <div id="reg-modal">
        <div class="modal-box">
            <h3 style="color:var(--accent)">РЕГИСТРАЦИЯ</h3>
            <input type="text" id="reg-name" placeholder="Придумай ник" style="width:90%; padding:10px; margin-bottom:10px; background:#000; border:1px solid #444; color:#fff;">
            <button class="nav-btn" onclick="confirmReg()">ПОДТВЕРДИТЬ</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script>
        let sashaMesh, isTalking = false;
        let chatHistory = []; // ПАМЯТЬ ЧАТА

        // --- ГОЛОС ---
        function speak(text) {
            window.speechSynthesis.cancel();
            const ut = new SpeechSynthesisUtterance(text);
            ut.pitch = 0.85; ut.rate = 1.0;
            ut.onstart = () => { isTalking = true; };
            ut.onend = () => { isTalking = false; };
            window.speechSynthesis.speak(ut);
        }

        // --- УМНЫЙ ЧАТ С ПАМЯТЬЮ ---
        async function askSasha() {
            const input = document.getElementById('user-input');
            const key = document.getElementById('api-key').value.trim();
            const text = input.value.trim();
            if (!text) return;

            addMsg("Вы", text);
            input.value = '';

            if (!key) {
                const r = "Босс, без API ключа я не могу подключить свои нейронные связи. Вставь его в углу!";
                addMsg("Саша", r);
                speak(r);
                return;
            }

            // Добавляем сообщение в историю для "памяти"
            chatHistory.push({ role: "user", parts: [{ text: text }] });

            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        contents: chatHistory,
                        systemInstruction: { parts: [{ text: "Ты Саша, дерзкий и умный ИИ. Ты помнишь контекст беседы. Отвечай кратко, помогай пользователю с сайтом AlexanderDev." }] }
                    })
                });
                const data = await res.json();
                const reply = data.candidates[0].content.parts[0].text;

                // Сохраняем ответ Саши в память
                chatHistory.push({ role: "model", parts: [{ text: reply }] });
                
                addMsg("Саша", reply);
                speak(reply);
            } catch (e) {
                addMsg("Саша", "Ошибка сети. Возможно, нужен VPN для API.");
            }
        }

        function addMsg(who, text) {
            const box = document.getElementById('messages');
            const cls = who === "Саша" ? "ai-msg" : "user-msg";
            box.innerHTML += `<div class="msg ${cls}"><b>${who}:</b> ${text}</div>`;
            box.scrollTop = box.scrollHeight;
        }

        // --- ЛОГИКА КНОПОК ---
        function openReg() { document.getElementById('reg-modal').style.display = 'flex'; }
        function confirmReg() {
            const name = document.getElementById('reg-name').value || "Аноним";
            document.getElementById('reg-modal').style.display = 'none';
            document.getElementById('login-btn').disabled = false;
            const greet = `Регистрация завершена. Привет, ${name}! Теперь кнопка входа активна. Я запомнил тебя.`;
            addMsg("Саша", greet);
            speak(greet);
        }

        // --- 3D САША ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        scene.add(new THREE.AmbientLight(0xffffff, 2.5));
        camera.position.z = 5;

        new THREE.GLTFLoader().load('https://raw.githubusercontent.com/aproyt4-lang/GameDevAlex/main/SashaAI.glb', (gltf) => {
            sashaMesh = gltf.scene;
            sashaMesh.position.y = -1.2;
            sashaMesh.scale.set(1.7, 1.7, 1.7);
            scene.add(sashaMesh);
            
            function animate() {
                requestAnimationFrame(animate);
                if(sashaMesh) {
                    sashaMesh.rotation.y += 0.005;
                    if(isTalking) sashaMesh.scale.y = 1.7 + Math.sin(Date.now() * 0.1) * 0.05;
                }
                renderer.render(scene, camera);
            }
            animate();
        });

        // Энтер в чате
        document.getElementById('user-input').addEventListener('keypress', (e) => { if(e.key === 'Enter') askSasha(); });
    </script>
</body>
</html>











