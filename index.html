<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Sasha AI</title>
<style>
:root { --neon:#00d8ff; --dark:#050505; }
html,body{margin:0;padding:0;background:var(--dark);color:#fff;font-family:Segoe UI;height:100%;overflow:hidden}

#sasha-viewport{position:fixed;inset:0;z-index:1;pointer-events:none}

#chat-container{
position:fixed;bottom:30px;left:30px;width:420px;height:480px;
background:rgba(10,10,10,.9);border-radius:10px;
display:flex;flex-direction:column;z-index:10
}

#messages{flex:1;padding:15px;overflow-y:auto;display:flex;flex-direction:column;gap:10px}
.msg{padding:10px;border-radius:6px;max-width:85%;font-size:14px}
.ai{background:rgba(0,216,255,.1);color:var(--neon);align-self:flex-start}
.user{background:#222;align-self:flex-end}

.input-row{display:flex;gap:8px;padding:10px;border-top:1px solid #333}
input{flex:1;background:#000;border:1px solid #444;color:#fff;padding:10px;border-radius:5px}
button{background:#000;border:1px solid var(--neon);color:var(--neon);padding:10px 18px;cursor:pointer}
</style>
</head>
<body>

<div id="sasha-viewport"></div>

<div id="chat-container">
<div id="messages">
<div class="msg ai"><b>СИСТЕМА:</b> Кликни для активации</div>
</div>
<div class="input-row">
<input id="user-in" placeholder="Напиши сообщение..." onkeydown="if(event.key==='Enter')askSasha()">
<button onclick="askSasha()">SEND</button>
</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>

<script>
let sasha,isSpeaking=false,activated=false;
const clock=new THREE.Clock();

/* ===== ЧАТ GPT ===== */
async function askSasha(){
    const input = document.getElementById("user-in");
    if(!input.value.trim()) return;

    addMsg("Вы", input.value, "user");

    const question = input.value;
    input.value = "";

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer YOUR_API_KEY" // <- вставь свой ключ OpenAI
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [{role:"user", content: question}]
            })
        });
        const data = await response.json();
        const answer = data.choices[0].message.content;
        addMsg("Саша", answer, "ai");
        speak(answer);
    } catch(err){
        addMsg("Саша", "Ошибка подключения к GPT API.", "ai");
    }
}

/* ===== ГОЛОС ===== */
function speak(text){
    speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(text);
    u.rate=1;
    u.pitch=0.9;
    u.onstart=()=>isSpeaking=true;
    u.onend=()=>isSpeaking=false;
    speechSynthesis.speak(u);
}

/* ===== ЧАТ ===== */
function addMsg(w,t,c){
    const messages = document.getElementById("messages");
    messages.innerHTML += `<div class="msg ${c}"><b>${w}:</b> ${t}</div>`;
    messages.scrollTop = messages.scrollHeight;
}

/* ===== АКТИВАЦИЯ ===== */
document.body.addEventListener("click", ()=>{
    if(activated) return;
    activated=true;
    const hi="Привет. Я Саша. Готова отвечать на любые вопросы.";
    addMsg("Саша", hi, "ai");
    speak(hi);
},{once:true});

/* ===== 3D МОДЕЛЬ ===== */
const scene=new THREE.Scene();
const cam=new THREE.PerspectiveCamera(45,innerWidth/innerHeight,0.1,1000);

const renderer=new THREE.WebGLRenderer({alpha:true,antialias:true});
renderer.setSize(innerWidth,innerHeight);
document.getElementById("sasha-viewport").appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff,2.5));

new THREE.GLTFLoader().load(
"https://raw.githubusercontent.com/aproyt4-lang/GameDevAlex/main/SashaAI.glb",
g=>{
  sasha=g.scene;
  sasha.position.set(0,0,0);
  sasha.scale.set(1.8,1.8,1.8);
  scene.add(sasha);

  cam.position.set(0,1.5,5);
  cam.lookAt(sasha.position);

  animate();
}
);

function animate(){
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();
    if(sasha){
        sasha.position.y = 0;

        // Смотрим горизонтально на камеру
        const target = new THREE.Vector3(cam.position.x, sasha.position.y, cam.position.z);
        sasha.lookAt(target);

        // Правильная ориентация
        sasha.rotation.x = 0;
        sasha.rotation.z = 0;
        sasha.rotation.y += THREE.MathUtils.degToRad(-90); // повернуть лицом к камере
    }
    renderer.render(scene, cam);
}

/* ===== РЕЗАЙЗ ===== */
window.addEventListener("resize", ()=>{
    cam.aspect = innerWidth/innerHeight;
    cam.updateProjectionMatrix();
    renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>














