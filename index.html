async function sendMessage() {
  const input = document.getElementById('msg-input');
  const text = input.value.trim();
  if (!text) return;
  
  const container = document.getElementById('messages');
  container.innerHTML += `<div class="msg user-msg">${text}</div>`;
  input.value = '';
  
  const loading = document.createElement('div');
  loading.className = 'msg ai-msg';
  loading.innerText = 'Саша думает...';
  container.appendChild(loading);
  container.scrollTop = container.scrollHeight;

  // ОБНОВЛЕННЫЙ КЛЮЧ И URL (Добавили -001 — это жесткая привязка к версии, чтобы не было 404)
  const MY_KEY = "AIzaSyC3hNnAMXw6bRYwTAxtAS-ZNeOrDfUqCSg"; 
  const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${MY_KEY}`;

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents: [{
          parts: [{ text: BRAINS + "\nВопрос: " + text }]
        }]
      })
    });

    const data = await response.json();

    if (response.ok && data.candidates) {
      const reply = data.candidates[0].content.parts[0].text;
      loading.innerText = "Саша: " + reply;
      speak(reply); // ГОЛОС ВКЛЮЧЕН
    } else {
      // Если опять 404, пробуем альтернативное имя модели прямо здесь
      console.error("Первая попытка мимо, пробую запасной путь...");
      const fallbackUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${MY_KEY}`;
      const res2 = await fetch(fallbackUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ contents: [{ parts: [{ text: BRAINS + "\n" + text }] }] })
      });
      const data2 = await res2.json();
      
      if (res2.ok) {
        const reply2 = data2.candidates[0].content.parts[0].text;
        loading.innerText = "Саша: " + reply2;
        speak(reply2);
      } else {
        loading.innerText = "Саша: Бро, ошибка " + res2.status + ". Проверь, что в Google AI Studio выбран именно 'Gemini 1.5 Flash'.";
      }
    }
  } catch (err) {
    loading.innerText = "Саша: Сеть легла!";
    console.error(err);
  }
  container.scrollTop = container.scrollHeight;
}

















