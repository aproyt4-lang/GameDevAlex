<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sasha AI - Autonomous Agent</title>
    <style>
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #121212; color: #fff; overflow-x: hidden; }
        header { background: #000; padding: 15px 30px; border-bottom: 2px solid #00d8ff; display: flex; justify-content: space-between; align-items: center; }
        header h1 { color: #00d8ff; margin: 0; font-size: 20px; letter-spacing: 2px; }
        .hero { position: relative; height: 500px; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle, #1a1a1a 0%, #000 100%); }
        #three-canvas { width: 100%; height: 100%; outline: none; }
        
        #chat-box { position: fixed; bottom: 20px; right: 20px; width: 350px; height: 450px; background: rgba(20,20,20,0.95); border: 2px solid #00d8ff; border-radius: 15px; display: flex; flex-direction: column; backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0,216,255,0.2); z-index: 1000; }
        #messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 14px; scroll-behavior: smooth; }
        .msg { padding: 10px 15px; border-radius: 10px; max-width: 85%; line-height: 1.4; word-wrap: break-word; }
        .ai-msg { background: #1e1e1e; color: #00d8ff; align-self: flex-start; border-left: 3px solid #00d8ff; }
        .user-msg { background: #00d8ff; color: #000; align-self: flex-end; font-weight: bold; }
        
        .input-area { display: flex; padding: 15px; border-top: 1px solid #333; }
        #msg-input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; outline: none; }
        #send-btn { background: #00d8ff; border: none; padding: 0 20px; margin-left: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #send-btn:hover { background: #fff; box-shadow: 0 0 15px #00d8ff; }
        
        /* Эффект загрузки */
        .typing { font-style: italic; color: #555; font-size: 12px; margin-left: 15px; display: none; }
    </style>
</head>
<body>

<header>
    <h1>ALEXANDER DEV <span style="color:#fff">| SASHA AI</span></h1>
</header>

<section class="hero">
    <canvas id="three-canvas"></canvas>
</section>

<div id="chat-box">
    <div id="messages">
        <div class="msg ai-msg">Саша: Система онлайн. Жду твоих указаний, Александр. Напиши что-нибудь, и я отвечу голосом!</div>
    </div>
    <div class="typing" id="status">Саша думает...</div>
    <div class="input-area">
        <input type="text" id="msg-input" placeholder="Введите команду или вопрос...">
        <button id="send-btn">SEND</button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
    // --- КОНФИГУРАЦИЯ ---
    const API_KEY = "AIzaSyCp4i-hZJWa7750aSuPnu0-mzGe6Mzp3_Q"; // Твой ключ внедрен
    const MODEL_URL = 'https://raw.githubusercontent.com/aproyt4-lang/GameDevAlex/main/SashaAI.glb';
    
    let sashaMesh;
    let audioContext, analyser, dataArray;
    let isSpeaking = false;

    // --- ИНИЦИАЛИЗАЦИЯ THREE.JS ---
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / 500, 0.1, 1000);
    camera.position.set(0, 0.5, 3);

    const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), antialias: true, alpha: true });
    renderer.setSize(window.innerWidth, 500);
    scene.add(new THREE.AmbientLight(0xffffff, 1.5));
    const pointLight = new THREE.PointLight(0x00d8ff, 2);
    pointLight.position.set(2, 2, 2);
    scene.add(pointLight);

    new THREE.GLTFLoader().load(MODEL_URL, (gltf) => {
        sashaMesh = gltf.scene;
        sashaMesh.scale.set(1.8, 1.8, 1.8);
        sashaMesh.position.y = -1;
        scene.add(sashaMesh);
        animate();
    });

    function animate() {
        requestAnimationFrame(animate);
        
        if (sashaMesh) {
            // Легкое покачивание (эффект дыхания)
            sashaMesh.position.y = -1 + Math.sin(Date.now() * 0.001) * 0.02;
            
            // ПРОГРАММНЫЙ ЛИПСИНК (Без Блендера)
            if (isSpeaking && analyser) {
                analyser.getByteFrequencyData(dataArray);
                let volume = dataArray.reduce((a, b) => a + b) / dataArray.length;
                let scaleShift = volume / 150; // Настраиваем чувствительность
                sashaMesh.scale.y = 1.8 + scaleShift; // Растягиваем голову по вертикали в такт звуку
            } else {
                sashaMesh.scale.y = THREE.MathUtils.lerp(sashaMesh.scale.y, 1.8, 0.1);
            }
        }
        renderer.render(scene, camera);
    }

    // --- ЛОГИКА ГОЛОСА И АНАЛИЗА ЗВУКА ---
    function initAudio() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            analyser.fftSize = 256;
            dataArray = new Uint8Array(analyser.frequencyBinCount);
        }
    }

    function speak(text) {
        initAudio();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ru-RU';
        utterance.rate = 1.0;

        utterance.onstart = () => { isSpeaking = true; };
        utterance.onend = () => { isSpeaking = false; };

        // Соединяем синтезатор с анализатором (хак для браузера)
        window.speechSynthesis.speak(utterance);
    }

    // --- СВЯЗЬ С GEMINI API ---
    async function getGeminiResponse(userPrompt) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
        
        const requestBody = {
            contents: [{
                parts: [{ text: `Ты - Саша, продвинутый AI-ассистент Александра. 
                Ты эксперт в Unity, C# и маркетинге. 
                Твоя задача: отвечать четко, иногда с юмором, как бро. 
                Если пользователь пишет белиберду, скажи что это не код.
                Отвечай кратко, чтобы было удобно слушать.
                Запрос пользователя: ${userPrompt}` }]
            }]
        };

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });
            const data = await response.json();
            return data.candidates[0].content.parts[0].text;
        } catch (error) {
            return "Бро, возникла ошибка в нейронных связях. Проверь консоль.";
        }
    }

    // --- ОБРАБОТКА ЧАТА ---
    async function sendMessage() {
        const input = document.getElementById('msg-input');
        const box = document.getElementById('messages');
        const status = document.getElementById('status');
        const text = input.value.trim();

        if (!text) return;

        box.innerHTML += `<div class="msg user-msg">${text}</div>`;
        input.value = '';
        status.style.display = 'block';
        box.scrollTop = box.scrollTop = box.scrollHeight;

        const aiResponse = await getGeminiResponse(text);
        
        status.style.display = 'none';
        box.innerHTML += `<div class="msg ai-msg">Саша: ${aiResponse}</div>`;
        box.scrollTop = box.scrollHeight;

        speak(aiResponse);
    }

    document.getElementById('send-btn').onclick = sendMessage;
    document.getElementById('msg-input').onkeypress = (e) => { if(e.key==='Enter') sendMessage(); };

    window.addEventListener('resize', () => {
        renderer.setSize(window.innerWidth, 500);
        camera.aspect = window.innerWidth / 500;
        camera.updateProjectionMatrix();
    });
</script>

</body>
</html>







